## Transform

### 1.算子类型：TransformNode

![Transform1](images/Transform/Transform1.png)

### 2.所属模块：3d_nodes

### 3.简单功能总结

> Transform算子用于元素空间变换，适用于Pose、Cube、PointCloud。

### 4.算子参数

- **type**：适用元素类型，默认为NONE。

|                  type                  |       功能       |
| :------------------------------------: | :--------------: |
|       <a href = "#Pose">Pose</a>       |  坐标空间变换。  |
|       <a href = "#Cube">Cube</a>       | 立方体空间变化。 |
| <a href = "#PointCloud">PointCloud</a> |  点云空间变换。  |

### 5.算子输入输出

#### 控制信号端口：

| Feature | 输入/输出                                                    |
| :-----: | ------------------------------------------------------------ |
|  start  | 触发start信号端口运行算子。运行成功触发右侧finished端口；运行失败触发右侧failed端口。 |
|  stop   | 算子运行中途触发stop信号端口，触发右侧的stopped信号。        |
|  reset  | 算子运行中途触发reset信号端口，则将当前算子重置，重新开始运算，同时右侧的reset信号也会被触发。 |

### 6.Type类型详细介绍

#### <font id = "Pose">Pose</font>

![TransformPose1](images/Transform/TransformPose1.png)

##### 算子参数

- **invert**：
  - True：勾选为True时，输出空间变换后的逆坐标。
  - False：输出空间变换后坐标。
- **transformed**：设置空间变换后的坐标可视化属性，默认为关闭状态。

|          属性          |                      图标                      | 值描述                                                       |
| :--------------------: | :--------------------------------------------: | :----------------------------------------------------------- |
| transformed_visibility |      ![visOn](images/Transform/visOn.png)      | 打开时，在3D视图中显示坐标；<br />关闭时，关闭坐标可视化；默认为关闭状态。 |
|   transformed_scale    | ![proportion](images/Transform/proportion.png) | 设置坐标的尺寸大小，范围在0.001~1000，默认为0.1。            |

- **transformed**：设置空间变换后的坐标列表可视化属性，值描述与上述transform一致。

##### 输入输出端口：

###### 数据信号输入端口：

|    Feature    | 数据类型 |      输入内容      |
| :-----------: | :------: | :----------------: |
|     base      |   Pose   |   需要变换的坐标   |
|   relative    |   Pose   |      相对坐标      |
|   base_list   | PoseList | 需要变换的坐标列表 |
| relative_list | PoseList |    相对坐标列表    |

> <svg t="1672282489264" class="icon" viewBox="0 -150 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5013" width="30" height="30"><path d="M536.4864 481.3184m-174.4 0a174.4 174.4 0 1 0 348.8 0 174.4 174.4 0 1 0-348.8 0Z" fill="#EBE150" p-id="5014"></path><path d="M412.1984 319.0912m-92.5312 0a92.5312 92.5312 0 1 0 185.0624 0 92.5312 92.5312 0 1 0-185.0624 0Z" fill="#F6F0A2" p-id="5015"></path><path d="M597.8496 792.2048H428.7104a19.2 19.2 0 0 1-19.2-19.2v-3.9552c0-56.9344-22.3232-111.4368-62.8736-153.4464A231.4112 231.4112 0 0 1 513.28 223.2832c127.68 0 231.552 103.8848 231.552 231.5648a230.2848 230.2848 0 0 1-65.664 161.536c-40.064 41.1136-62.1184 94.528-62.1184 150.336v6.2336a19.2 19.2 0 0 1-19.2 19.2512z m-150.3872-38.4h131.52c3.1744-61.184 28.6976-119.04 72.6784-164.2112a192.128 192.128 0 0 0 54.7712-134.7456c0-106.5088-86.6432-193.1648-193.152-193.1648-106.8416 0-191.68 83.6608-193.1392 190.4512a192 192 0 0 0 54.1312 136.8064c43.8656 45.4528 69.5296 103.5392 73.1904 164.864z" p-id="5016"></path><path d="M539.072 882.7264h-51.584a78.08 78.08 0 0 1-77.9776-77.9904v-31.7312a19.2 19.2 0 0 1 19.2-19.2h169.1392a19.2 19.2 0 0 1 19.2 19.2v31.7312a78.08 78.08 0 0 1-77.9776 77.9904z m-91.1616-90.5216v12.5312a39.68 39.68 0 0 0 39.5776 39.5904h51.584a39.68 39.68 0 0 0 39.5776-39.5904v-12.5312zM508.5824 190.2848a19.2 19.2 0 0 1-19.2-19.2v-59.008a19.2 19.2 0 0 1 38.4 0v59.008a19.2 19.2 0 0 1-19.2 19.2zM350.08 237.8112a19.2 19.2 0 0 1-16.64-9.6128l-29.504-51.0976a19.2 19.2 0 0 1 33.28-19.2l29.504 51.0976a19.2 19.2 0 0 1-16.64 28.8128zM236.5184 358.208a19.2 19.2 0 0 1-9.5872-2.56l-51.0976-29.44a19.2 19.2 0 0 1 19.2-33.28l51.0976 29.504a19.2 19.2 0 0 1-9.6128 35.84zM790.0416 341.9392a19.2 19.2 0 0 1-9.6128-35.84l51.0976-29.44a19.2 19.2 0 1 1 19.2 33.28l-51.0976 29.504a19.072 19.072 0 0 1-9.5872 2.496zM669.6064 228.4032a19.2 19.2 0 0 1-16.64-28.8L682.496 148.48a19.2 19.2 0 0 1 33.28 19.2l-29.44 51.0976a19.2 19.2 0 0 1-16.7296 9.6256z" p-id="5017"></path></svg> base/base_list端口和relative/relative_list端口连接时，单个base可以和单个relative连接，也可以和relative_list连接。只需要连接两个端口即可。

###### 数据信号输出端口：

|    Feature     | 数据类型 |      输出内容      |
| :------------: | :------: | :----------------: |
|   transform    |   Pose   |   变换后坐标数据   |
| transform_list | PoseList | 变换后坐标列表数据 |

##### 功能演示

> 使用Transform算子将相机的rgb坐标转换到机器人坐标系。

###### I.算子准备

1. Trigger：触发器，用于启动其他算子。
2. Emit：生成元素，案例中用于生成两个pose
3. Transform：元素空间变换，案例中用于转换坐标。

###### II. 算子图

1. 拖入两个Emit算子，type属性都选择“Pose”，并分别从命名为“TCP2robot”和“rgb2TCP”；
2. 输入Emit算子pose参数值，一个为相机的tcp值，一个为机器人手眼标定的结果。
3. 拖入Transform算子，type属性选择“Pose”。
4. 将控制信号端口和数据信号端口连接，如下图：

![TransFormpose2](images/Transform/TransFormpose2.png)

###### III.算子功能演示

1. 打开Emit算子和Transform算子的可视化属性；
2. 触发Trigger算子，3D视图显示如下：

![3](images/Transform/3.png)



------

#### <font id = "Cube">Cube</font>

![TransformCube2](images/Transform/TransformCube2.png)

##### 算子参数

- **invert**：
  - **True**：勾选为True时，输出空间变换后的逆坐标。
  - **False**：输出空间变换后坐标。
- **cube**：设置空间变换后的cube可视化属性，默认为关闭状态。

|         属性         |                          图标                          | 值描述                                                       |
| :------------------: | :----------------------------------------------------: | :----------------------------------------------------------- |
| cube_list_visibility | ![visOn](images/Transform/visOn-1676255822206-155.png) | 打开时，在3D视图中显示立方体列表；<br />关闭时，关闭cube可视化；默认为关闭状态。 |
|   cube_list_color    |          ![color](images/Transform/color.png)          | 设置3D视图中立方体列表的颜色；<br />为**-2**时，显示白色<br />为**-1**时，显示随机色（范围在0~360，0为红色，360为紫色）<br />设置值为**0 - 360**，0表示红色，120表示绿色，240表示蓝色，360表示紫色，也可取其他数值来指定颜色。 |
|  cube_list_opacity   |        ![opacity](images/Transform/opacity.png)        | 设置立方体列表透明度；范围在0~1；默认为0.5。                 |

- **cube_list**：设置cube_list的可视化属性，值描述与上述cube一致。
- **pose**：设置立方体中心点坐标的可视化属性，默认为关闭状态。

|      属性       |                             图标                             | 值描述                                                       |
| :-------------: | :----------------------------------------------------------: | :----------------------------------------------------------- |
| pose_visibility |    ![visOn](images/Transform/visOn-1676255836969-159.png)    | 打开时，在3D视图中显示坐标；<br />关闭时，关闭坐标可视化；默认为关闭状态。 |
|   pose_scale    | ![proportion](images/Transform/proportion-1676255841824-161.png) | 设置坐标的尺寸大小，范围在0.001~1000，默认为0.1。            |

- **transformed**：设置空间变换后的坐标列表可视化属性，值描述与上述transform一致。

##### 输入输出端口：

###### 数据信号输入端口：

|    Feature    | 数据类型 |      输入内容      |
| :-----------: | :------: | :----------------: |
|   cube_base   |   Cube   |   需要变换的cube   |
|     pose      |   Pose   |      相对坐标      |
|   pose_list   | PoseList |    相对坐标列表    |
| cube_relative | PoseList | 需要变换的cube列表 |

###### 数据信号输出端口：

|  Feature  | 数据类型 |          输出内容          |
| :-------: | :------: | :------------------------: |
|   cube    |   Cube   |      变换后立方体数据      |
| cube_list | CubeList |    变换后立方体列表数据    |
|   pose    |   Pose   |   变换后立方体中心点坐标   |
| pose_list | Poselist | 变换后立方体中心点坐标列表 |

##### 功能演示

> Cube部分的功能演示与**PointCloud**中类似，请参照Transform-PointCloud章节进行学习。



------

#### <font id = "PointCloud">PointCloud</font>

![TransformPointCloud1](images/Transform/TransformPointCloud1.png)

##### 算子参数

- **pointcloud**：设置空间变换后的点云可视化属性，默认为关闭状态。

|         属性          |                             图标                             | 值描述                                                       |
| :-------------------: | :----------------------------------------------------------: | :----------------------------------------------------------- |
| pointcloud_visibility |    ![visOn](images/Transform/visOn-1676255850917-163.png)    | 打开时，在3D视图中显示点云；<br />关闭时，关闭点云可视化；默认为关闭状态。 |
|   pointcloud_color    |    ![color](images/Transform/color-1676255865331-165.png)    | 设置3D视图中点云的颜色；<br />为**-2**时，显示点云原始颜色<br />为**-1**时，显示随机色（范围在0~360，0为红色，360为紫色）<br />设置值为**0 - 360**，0表示红色，120表示绿色，240表示蓝色，360表示紫色，也可取其他数值来指定颜色。 |
| pointcloud_point_size | ![proportion](images/Transform/proportion-1676255870987-167.png) | 设置点云中点的大小；范围在1~50；默认为1。                    |

- **pointcloud_list**：设置点云列表的可视化属性，值描述与上述pointcloud值描述一致。

##### 输入输出端口：

###### 数据信号输入端口：

|  Feature   |  数据类型  |    输入内容    |
| :--------: | :--------: | :------------: |
| pointcloud | PointCloud | 需要变换的点云 |
|    pose    |    Pose    |    相对坐标    |
| pose_list  |  PoseList  |  相对坐标列表  |

###### 数据信号输出端口：

|     Feature     |    数据类型    |      输出内容      |
| :-------------: | :------------: | :----------------: |
|   pointcloud    |   PointCloud   |   变换后点云数据   |
| pointcloud_list | PointCloudList | 变换后点云列表数据 |

##### 功能演示

> 使用Transform算子将点云进行空间变换。

###### I.算子准备

1. Trigger：触发器，用于启动其他算子。
2. Load：加载元素，用于加载点云。
3. Transform：元素空间变换，案例中用于转换点云。

###### II. 算子图

1. 
2. 拖入Transform算子，type属性选择“Pose”。
3. 将控制信号端口和数据信号端口连接，如下图：

![Transformpointcloud1](images/Transform/Transformpointcloud1.png)

###### III.算子功能演示

1. 打开Load算子的点云可视化属性；
2. 打开Transform算子的点云可视化属性；
3. 下图为点云转换前后的对比图（绿色点云为Load算子加载的点云，蓝色点云为Transform算子转换后的点云）：

![稿定设计导出-20230203-111451](images/Transform/稿定设计导出-20230203-111451.jpg)